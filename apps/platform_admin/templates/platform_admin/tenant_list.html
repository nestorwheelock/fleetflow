{% extends "platform_admin/base.html" %}

{% block title %}Tenants{% endblock %}

{% block content %}
<div class="mb-6 flex items-center justify-between">
    <div>
        <h1 class="text-2xl font-bold text-white">Tenants</h1>
        <p class="text-gray-400">Manage all rental companies on the platform</p>
    </div>
</div>

<!-- Filters -->
<div class="bg-gray-800 border border-gray-700 rounded-lg p-4 mb-6">
    <form method="get" class="flex flex-wrap gap-4 items-end">
        <div class="flex-1 min-w-[200px]">
            <label class="block text-sm text-gray-400 mb-1">Search</label>
            <input type="text" name="search" value="{{ search }}"
                   class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:border-platform-500"
                   placeholder="Name, slug, email...">
        </div>
        <div>
            <label class="block text-sm text-gray-400 mb-1">Plan</label>
            <select name="plan" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:border-platform-500">
                <option value="">All Plans</option>
                {% for value, label in plan_choices %}
                <option value="{{ value }}" {% if plan_filter == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block text-sm text-gray-400 mb-1">Status</label>
            <select name="status" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:border-platform-500">
                <option value="">All Status</option>
                <option value="active" {% if status_filter == 'active' %}selected{% endif %}>Active</option>
                <option value="trialing" {% if status_filter == 'trialing' %}selected{% endif %}>Trialing</option>
                <option value="past_due" {% if status_filter == 'past_due' %}selected{% endif %}>Past Due</option>
                <option value="suspended" {% if status_filter == 'suspended' %}selected{% endif %}>Suspended</option>
            </select>
        </div>
        <div>
            <button type="submit" class="px-4 py-2 bg-platform-600 text-white rounded hover:bg-platform-700 focus:outline-none">
                Filter
            </button>
        </div>
    </form>
</div>

<!-- Tenant List -->
<div class="bg-gray-800 border border-gray-700 rounded-lg overflow-hidden">
    <table class="w-full">
        <thead class="bg-gray-900">
            <tr>
                <th class="px-4 py-3 text-left text-sm font-medium text-gray-400">Tenant</th>
                <th class="px-4 py-3 text-left text-sm font-medium text-gray-400">Owner</th>
                <th class="px-4 py-3 text-left text-sm font-medium text-gray-400">Plan</th>
                <th class="px-4 py-3 text-left text-sm font-medium text-gray-400">Status</th>
                <th class="px-4 py-3 text-left text-sm font-medium text-gray-400">Users</th>
                <th class="px-4 py-3 text-left text-sm font-medium text-gray-400">Created</th>
                <th class="px-4 py-3 text-right text-sm font-medium text-gray-400">Actions</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-700">
            {% for tenant in tenants %}
            <tr class="hover:bg-gray-700">
                <td class="px-4 py-3">
                    <a href="{% url 'platform_admin:tenant_detail' tenant.pk %}" class="text-platform-400 hover:text-platform-300 font-medium">
                        {{ tenant.name }}
                    </a>
                    <div class="text-xs text-gray-500">{{ tenant.slug }}</div>
                </td>
                <td class="px-4 py-3 text-gray-300">
                    {{ tenant.owner.email }}
                </td>
                <td class="px-4 py-3">
                    <span class="px-2 py-1 text-xs rounded-full
                        {% if tenant.plan == 'enterprise' %}bg-purple-900 text-purple-300
                        {% elif tenant.plan == 'business' %}bg-blue-900 text-blue-300
                        {% elif tenant.plan == 'professional' %}bg-green-900 text-green-300
                        {% else %}bg-gray-700 text-gray-300{% endif %}">
                        {{ tenant.get_plan_display }}
                    </span>
                </td>
                <td class="px-4 py-3">
                    {% if not tenant.is_active %}
                    <span class="px-2 py-1 text-xs rounded-full bg-red-900 text-red-300">Suspended</span>
                    {% elif tenant.subscription_status == 'active' %}
                    <span class="px-2 py-1 text-xs rounded-full bg-green-900 text-green-300">Active</span>
                    {% elif tenant.subscription_status == 'trialing' %}
                    <span class="px-2 py-1 text-xs rounded-full bg-blue-900 text-blue-300">Trial</span>
                    {% elif tenant.subscription_status == 'past_due' %}
                    <span class="px-2 py-1 text-xs rounded-full bg-yellow-900 text-yellow-300">Past Due</span>
                    {% else %}
                    <span class="px-2 py-1 text-xs rounded-full bg-gray-700 text-gray-300">{{ tenant.get_subscription_status_display }}</span>
                    {% endif %}
                </td>
                <td class="px-4 py-3 text-gray-300">
                    {{ tenant.user_count }}
                </td>
                <td class="px-4 py-3 text-gray-400 text-sm">
                    {{ tenant.created_at|date:"M d, Y" }}
                </td>
                <td class="px-4 py-3 text-right">
                    <a href="{% url 'platform_admin:tenant_detail' tenant.pk %}" class="text-platform-400 hover:text-platform-300 text-sm">
                        View
                    </a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                    No tenants found
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if page_obj.has_other_pages %}
<div class="mt-4 flex items-center justify-center space-x-2">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}{% if search %}&search={{ search }}{% endif %}{% if plan_filter %}&plan={{ plan_filter }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}"
       class="px-3 py-1 bg-gray-700 text-gray-300 rounded hover:bg-gray-600">Previous</a>
    {% endif %}

    <span class="text-gray-400">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </span>

    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}{% if search %}&search={{ search }}{% endif %}{% if plan_filter %}&plan={{ plan_filter }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}"
       class="px-3 py-1 bg-gray-700 text-gray-300 rounded hover:bg-gray-600">Next</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
